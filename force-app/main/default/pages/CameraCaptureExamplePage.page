<apex:page sidebar="false" showHeader="false">
    <video class="videoFrame" width="100%"></video><br/>
    <input type="button" class="captureButton"  id="capture" value="撮影"/>
    <!-- <hr/> -->
    <canvas height="0" width="0" style="visibility:hidden;position:fixed;top:-1000px;left:-1000px;"/>

    <script src="https://code.jquery.com/jquery-1.12.0.min.js" />
    <script type="text/javascript">
        // Mobile Safariでvideoタグが表示できないためのトリック対応
        var video = document.querySelector('video');
        video.setAttribute("autoplay", true);
        video.setAttribute("playsinline", true);
        video.setAttribute("controls", true);
        setTimeout(() => {
            video.removeAttribute("controls");
        });
    
        //ストリームを準備
        var constraints = {
            audio: false,
            video: {},
        }
        var item = navigator.mediaDevices.getUserMedia(constraints);
        item.then( function(stream) {
            video.srcObject = stream;
            video.onloadedmetadata = function(e) {
                //ロード完了後にカメラの設定
                $("#capture").on("click",function(){
                    captureImage();
                });
           };
        });
    
    
        //撮影
        function captureImage(){
            //canvasへ書き込み
            var video = $("video");
            var canvas = $("canvas")[0];
            canvas.width = video[0].videoWidth;
            canvas.height = video[0].videoHeight;
            var context2d = canvas.getContext('2d');
            context2d.drawImage(video[0], 0, 0);
                
            //Lightningに送信
            var lexOrigin = "https://momentum-saas-5317-dev-ed.lightning.force.com";
            var message = canvas.toDataURL('image/jpeg');
            parent.postMessage(message, lexOrigin);
        }
    </script>
    <style type="text/css">
        body{
            text-align:center;
        }
        .captureButton{
            transition:all 0.2s ease;
            color:rgba(91,26,133,1);
            background-color:white;
            border:4px solid #0071be;
            width:80%;
            height:50px;
            font-size:27px;
            font-weight:bold;
            margin-top:10px;
            border-radius:0px;
            box-shadow:0px 0px 5px 2px rgba(91,26,133,0.6);
        }
        .captureButton:hover{
            box-shadow:0px 0px 10px 2px rgba(91,26,133,0.4);
        }
        .captureButton:active{
            background-color:rgba(91,26,133,0.4);
        }
        .captureButton:focus{
            background-color:rgba(91,26,133,0.2);
        }
        .captureButton:focus, .captureButton:active{
            outline:0;
            box-shadow:0px 0px 0px 0px rgba(91,26,133,0.6);
        }

    </style>
</apex:page>